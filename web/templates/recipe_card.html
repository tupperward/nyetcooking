<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ recipe.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="https://worstwizard.online/favicon.ico">
    <link rel="icon" type="image/png" href="https://worstwizard.online/mage.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ recipe.name }}">
    <meta property="og:description" content="{% if recipe.description %}{{ recipe.description[:200] }}{% if recipe.description|length > 200 %}...{% endif %}{% else %}A delicious recipe from Nyetcooking{% endif %}">
    {% if recipe.image %}
        {% if recipe.image is string %}
            <meta property="og:image" content="{{ recipe.image }}">
        {% elif recipe.image is mapping %}
            {% if recipe.image.url %}
                <meta property="og:image" content="{{ recipe.image.url }}">
            {% elif recipe.image.contentUrl %}
                <meta property="og:image" content="{{ recipe.image.contentUrl }}">
            {% endif %}
        {% elif recipe.image is iterable and recipe.image[0] %}
            {% if recipe.image[0] is string %}
                <meta property="og:image" content="{{ recipe.image[0] }}">
            {% elif recipe.image[0].url %}
                <meta property="og:image" content="{{ recipe.image[0].url }}">
            {% elif recipe.image[0].contentUrl %}
                <meta property="og:image" content="{{ recipe.image[0].contentUrl }}">
            {% endif %}
        {% endif %}
    {% endif %}
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="Nyetcooking">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ recipe.name }}">
    <meta name="twitter:description" content="{% if recipe.description %}{{ recipe.description[:200] }}{% if recipe.description|length > 200 %}...{% endif %}{% else %}A delicious recipe from Nyetcooking{% endif %}">
    {% if recipe.image %}
        {% if recipe.image is string %}
            <meta name="twitter:image" content="{{ recipe.image }}">
        {% elif recipe.image is mapping %}
            {% if recipe.image.url %}
                <meta name="twitter:image" content="{{ recipe.image.url }}">
            {% elif recipe.image.contentUrl %}
                <meta name="twitter:image" content="{{ recipe.image.contentUrl }}">
            {% endif %}
        {% elif recipe.image is iterable and recipe.image[0] %}
            {% if recipe.image[0] is string %}
                <meta name="twitter:image" content="{{ recipe.image[0] }}">
            {% elif recipe.image[0].url %}
                <meta name="twitter:image" content="{{ recipe.image[0].url }}">
            {% elif recipe.image[0].contentUrl %}
                <meta name="twitter:image" content="{{ recipe.image[0].contentUrl }}">
            {% endif %}
        {% endif %}
    {% endif %}

    <!-- Additional meta tags for better SEO -->
    <meta name="description" content="{% if recipe.description %}{{ recipe.description[:160] }}{% if recipe.description|length > 160 %}...{% endif %}{% else %}A delicious recipe from Nyetcooking{% endif %}">
    {% if recipe.author and recipe.author.name %}
    <meta name="author" content="{{ recipe.author.name }}">
    {% endif %}
    {% if recipe.keywords %}
    <meta name="keywords" content="{{ recipe.keywords }}">
    {% endif %}

    <link rel="stylesheet" href="https://worstwizard.online/css/styles.43ee99b54232661dd9ded14dced8cab56cfc208d9b1cd7fc75f4bc3973f80a4957d7330ced2d8e5ad3390d3a28ad121be3e6db4701ac0b84fa518a99b482e717.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/recipe_card.css') }}">
</head>
<body>
    <div class="action-buttons no-print">
        <button class="action-button" onclick="copyURL(event)">üîó Copy URL</button>
        <button class="action-button" onclick="window.print()">üñ®Ô∏è Print</button>
        <button class="action-button" onclick="copyMarkdown()">üìã Copy MD</button>
    </div>

    <header>
        <h1>{{ recipe.name }}</h1>
        {% set author_name = none %}
        {% if recipe.author %}
            {% if recipe.author is mapping and recipe.author.name %}
                {% set author_name = recipe.author.name %}
            {% elif recipe.author is iterable and recipe.author is not string and recipe.author|length > 0 %}
                {% if recipe.author[0].name %}
                    {% set author_name = recipe.author[0].name %}
                {% endif %}
            {% endif %}
        {% endif %}
        {% if author_name %}
        <p>By {{ author_name }}{% if request.path | extract_domain %} from {{ request.path | extract_domain }}{% endif %}</p>
        {% elif request.path | extract_domain %}
        <p>From {{ request.path | extract_domain }}</p>
        {% endif %}
        <div class="no-print" style="text-align: center; margin-top: 25px; margin-bottom: -10px;">
            <button class="action-button" onclick="copySourceURL(event)" style="position: static;">üîó Copy Source</button>
        </div>
    </header>

    <div class="container">
        {% if recipe.image %}
            {% if recipe.image is string %}
                <img src="{{ recipe.image }}" alt="{{ recipe.name }}">
            {% elif recipe.image is mapping %}
                {# Handle single ImageObject: {"@type": "ImageObject", "url": "..."} #}
                {% if recipe.image.url %}
                    <img src="{{ recipe.image.url }}" alt="{{ recipe.name }}">
                {% elif recipe.image.contentUrl %}
                    <img src="{{ recipe.image.contentUrl }}" alt="{{ recipe.name }}">
                {% endif %}
            {% elif recipe.image is iterable and recipe.image[0] %}
                {% if recipe.image[0] is string %}
                    <img src="{{ recipe.image[0] }}" alt="{{ recipe.name }}">
                {% elif recipe.image[0].url %}
                    <img src="{{ recipe.image[0].url }}" alt="{{ recipe.name }}">
                {% elif recipe.image[0].contentUrl %}
                    <img src="{{ recipe.image[0].contentUrl }}" alt="{{ recipe.name }}">
                {% endif %}
            {% endif %}
        {% endif %}

        <div class="recipe-meta">
            {% if recipe.totalTime %}
            <div>
                <strong>Total Time</strong>
                <span>{{ recipe.totalTime | format_duration }}</span>
            </div>
            {% endif %}
            {% if recipe.recipeYield %}
            <div>
                <strong>Serves</strong>
                <span>{{ recipe.recipeYield }}</span>
            </div>
            {% endif %}
            {% if recipe.prepTime %}
            <div>
                <strong>Prep Time</strong>
                <span>{{ recipe.prepTime | format_duration }}</span>
            </div>
            {% endif %}
            {% if recipe.cookTime %}
            <div>
                <strong>Cook Time</strong>
                <span>{{ recipe.cookTime | format_duration }}</span>
            </div>
            {% endif %}
        </div>

        {% if recipe.description %}
        <p class="description"><em>{{ recipe.description }}</em></p>
        {% endif %}

        <div class="recipe-content">
            <div class="ingredients-section">
                <h2>Ingredients</h2>
                <ul>
                    {% for ingredient in recipe.recipeIngredient %}
                    <li>{{ ingredient }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="instructions-section">
                <h2>Instructions</h2>
                <ol>
                    {% for step in recipe.recipeInstructions | flatten_instructions %}
                    <li>{{ step }}</li>
                    {% endfor %}
                </ol>
            </div>
        </div>

        {% if recipe.tips %}
        <div class="tips-section">
            <h2>Tips</h2>
            <ul>
                {% for tip in recipe.tips %}
                <li>{{ tip }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if recipe.notes %}
        <div class="notes-section">
            <h2>Notes</h2>
            <p>{{ recipe.notes }}</p>
        </div>
        {% endif %}

        {% if recipe.aggregateRating and recipe.aggregateRating.ratingValue %}
        <div class="rating">
            <strong>{{ recipe.aggregateRating.ratingValue }}</strong> out of 5 stars
            {% if recipe.aggregateRating.reviewCount %}(based on {{ recipe.aggregateRating.reviewCount }} reviews){% endif %}
        </div>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/recipe_card.js') }}"></script>
</body>
</html>
